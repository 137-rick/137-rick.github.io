<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,maximum-scale=2">
  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>c++ 11 utf8 substr &amp;&amp; length 中英混合 | 徐艺洲</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="c++ 11 utf8 substr &amp;&amp; length 中英混合" />
<meta name="author" content="徐艺洲" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="改编自：http://www.zedwood.com/article/cpp-utf-8-mb_substr-function 这个也有问题，我基础这个改了个完善的另外写了个文字个数统计&lt;/p&gt; uint64_t pinyin::utf8_len(const std::string &amp;str) { uint64_t i = 0; uint64_t count =0; uint64_t c; for (i = 0; i &lt;str.length(); i++) { count++; c = (unsigned char) str[i]; if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0; else if ((c &amp; 0xE0) == 0xC0) i += 1; else if ((c &amp; 0xF0) == 0xE0) i += 2; else if ((c &amp; 0xF8) == 0xF0) i += 3; //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8 //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8 else return 0;//invalid utf8 } return count; } std::string pinyin::utf8_substr(const std::string &amp;str,uint64_t start, uint64_t leng) { if (leng == 0) { return&#8221;&#8221;; } uint64_t c, i, ix, q,min = std::string::npos, max = std::string::npos; for (q = 0, i = 0, ix =str.length(); i &lt; ix; i++, q++) { if (q == start) { min = i; } if (q &lt;= start + leng || leng ==std::string::npos) { max = i; } c = (unsigned char) str[i]; if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0; else if ((c &amp; 0xE0) == 0xC0) i += 1; else if ((c &amp; 0xF0) == 0xE0) i += 2; else if ((c &amp; 0xF8) == 0xF0) i += 3; //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8 //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8 else return &#8220;&#8221;;//invalid utf8 } if (q &lt;= start + leng|| leng == std::string::npos) { max = i; } if (min ==std::string::npos || max == std::string::npos) { return &#8220;&#8221;; } return str.substr(min,max &#8211; min); }" />
<meta property="og:description" content="改编自：http://www.zedwood.com/article/cpp-utf-8-mb_substr-function 这个也有问题，我基础这个改了个完善的另外写了个文字个数统计&lt;/p&gt; uint64_t pinyin::utf8_len(const std::string &amp;str) { uint64_t i = 0; uint64_t count =0; uint64_t c; for (i = 0; i &lt;str.length(); i++) { count++; c = (unsigned char) str[i]; if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0; else if ((c &amp; 0xE0) == 0xC0) i += 1; else if ((c &amp; 0xF0) == 0xE0) i += 2; else if ((c &amp; 0xF8) == 0xF0) i += 3; //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8 //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8 else return 0;//invalid utf8 } return count; } std::string pinyin::utf8_substr(const std::string &amp;str,uint64_t start, uint64_t leng) { if (leng == 0) { return&#8221;&#8221;; } uint64_t c, i, ix, q,min = std::string::npos, max = std::string::npos; for (q = 0, i = 0, ix =str.length(); i &lt; ix; i++, q++) { if (q == start) { min = i; } if (q &lt;= start + leng || leng ==std::string::npos) { max = i; } c = (unsigned char) str[i]; if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0; else if ((c &amp; 0xE0) == 0xC0) i += 1; else if ((c &amp; 0xF0) == 0xE0) i += 2; else if ((c &amp; 0xF8) == 0xF0) i += 3; //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8 //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8 else return &#8220;&#8221;;//invalid utf8 } if (q &lt;= start + leng|| leng == std::string::npos) { max = i; } if (min ==std::string::npos || max == std::string::npos) { return &#8220;&#8221;; } return str.substr(min,max &#8211; min); }" />
<link rel="canonical" href="http://localhost:4000/archives/196" />
<meta property="og:url" content="http://localhost:4000/archives/196" />
<meta property="og:site_name" content="徐艺洲" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-02T21:19:07+08:00" />
<script type="application/ld+json">
{"description":"改编自：http://www.zedwood.com/article/cpp-utf-8-mb_substr-function 这个也有问题，我基础这个改了个完善的另外写了个文字个数统计&lt;/p&gt; uint64_t pinyin::utf8_len(const std::string &amp;str) { uint64_t i = 0; uint64_t count =0; uint64_t c; for (i = 0; i &lt;str.length(); i++) { count++; c = (unsigned char) str[i]; if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0; else if ((c &amp; 0xE0) == 0xC0) i += 1; else if ((c &amp; 0xF0) == 0xE0) i += 2; else if ((c &amp; 0xF8) == 0xF0) i += 3; //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8 //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8 else return 0;//invalid utf8 } return count; } std::string pinyin::utf8_substr(const std::string &amp;str,uint64_t start, uint64_t leng) { if (leng == 0) { return&#8221;&#8221;; } uint64_t c, i, ix, q,min = std::string::npos, max = std::string::npos; for (q = 0, i = 0, ix =str.length(); i &lt; ix; i++, q++) { if (q == start) { min = i; } if (q &lt;= start + leng || leng ==std::string::npos) { max = i; } c = (unsigned char) str[i]; if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0; else if ((c &amp; 0xE0) == 0xC0) i += 1; else if ((c &amp; 0xF0) == 0xE0) i += 2; else if ((c &amp; 0xF8) == 0xF0) i += 3; //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8 //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8 else return &#8220;&#8221;;//invalid utf8 } if (q &lt;= start + leng|| leng == std::string::npos) { max = i; } if (min ==std::string::npos || max == std::string::npos) { return &#8220;&#8221;; } return str.substr(min,max &#8211; min); }","author":{"@type":"Person","name":"徐艺洲"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/archives/196"},"@type":"BlogPosting","url":"http://localhost:4000/archives/196","headline":"c++ 11 utf8 substr &amp;&amp; length 中英混合","dateModified":"2016-03-02T21:19:07+08:00","datePublished":"2016-03-02T21:19:07+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
  <header class="inner">
    

    <h1 id="project_title">徐艺洲</h1>
    <h2 id="project_tagline">知止定静安虑得</h2>
  </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
  <section id="main_content" class="inner">
    <div id="sina_keyword_ad_area2" class="articalContent   newfont_family">
  <div>
    改编自：http://www.zedwood.com/article/cpp-utf-8-mb_substr-function
  </div>
  
  <div>
    这个也有问题，我基础这个改了个完善的另外写了个文字个数统计&lt;/p&gt; 
    
    <div>
    </div>
  </div>
  
  <div>
  </div>
  
  <div>
    <div>
      uint64_t pinyin::utf8_len(const std::string &amp;str) {
    </div>
    
    <div>
      uint64_t i = 0;
    </div>
    
    <div>
      uint64_t count =0;
    </div>
    
    <div>
      uint64_t c;
    </div>
    
    <div>
    </div>
    
    <div>
      for (i = 0; i &lt;str.length(); i++) {
    </div>
    
    <div>
      count++;
    </div>
    
    <div>
    </div>
    
    <div>
      c = (unsigned char) str[i];
    </div>
    
    <div>
      if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0;
    </div>
    
    <div>
      else if ((c &amp; 0xE0) == 0xC0) i += 1;
    </div>
    
    <div>
      else if ((c &amp; 0xF0) == 0xE0) i += 2;
    </div>
    
    <div>
      else if ((c &amp; 0xF8) == 0xF0) i += 3;
    </div>
    
    <div>
      //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8
    </div>
    
    <div>
      //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8
    </div>
    
    <div>
      else return 0;//invalid utf8
    </div>
    
    <div>
      }
    </div>
    
    <div>
      return count;
    </div>
    
    <div>
      }
    </div>
    
    <div>
    </div>
    
    <div>
      std::string pinyin::utf8_substr(const std::string &amp;str,uint64_t start, uint64_t leng) {
    </div>
    
    <div>
      if (leng == 0) { return&#8221;&#8221;; }
    </div>
    
    <div>
      uint64_t c, i, ix, q,min = std::string::npos, max = std::string::npos;
    </div>
    
    <div>
      for (q = 0, i = 0, ix =str.length(); i &lt; ix; i++, q++) {
    </div>
    
    <div>
      if (q == start) { min = i; }
    </div>
    
    <div>
      if (q &lt;= start + leng || leng ==std::string::npos) { max = i; }
    </div>
    
    <div>
    </div>
    
    <div>
      c = (unsigned char) str[i];
    </div>
    
    <div>
      if (c &gt;= 0 &amp;&amp; c &lt;= 127) i +=0;
    </div>
    
    <div>
      else if ((c &amp; 0xE0) == 0xC0) i += 1;
    </div>
    
    <div>
      else if ((c &amp; 0xF0) == 0xE0) i += 2;
    </div>
    
    <div>
      else if ((c &amp; 0xF8) == 0xF0) i += 3;
    </div>
    
    <div>
      //else if(($c &amp; 0xFC) == 0xF8) i+=4; // 111110bb //byte 5, unnecessaryin 4 byte UTF-8
    </div>
    
    <div>
      //else if(($c &amp; 0xFE) == 0xFC) i+=5; // 1111110b //byte 6, unnecessaryin 4 byte UTF-8
    </div>
    
    <div>
      else return &#8220;&#8221;;//invalid utf8
    </div>
    
    <div>
      }
    </div>
    
    <div>
      if (q &lt;= start + leng|| leng == std::string::npos) { max = i; }
    </div>
    
    <div>
      if (min ==std::string::npos || max == std::string::npos) { return &#8220;&#8221;; }
    </div>
    
    <div>
      return str.substr(min,max &#8211; min);
    </div>
    
    <div>
      }
    </div>
  </div>
</div>

  </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
  <footer class="inner">
    
    <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
  </footer>
</div>


</body>
</html>
