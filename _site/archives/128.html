<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>转：用Imagick替代php的GD库-强大~ | 徐艺洲</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="转：用Imagick替代php的GD库-强大~" />
<meta name="author" content="徐艺洲" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一般用php处理图片都是使用GD库或者GD2的函数库，一般编译php环境都会搭上GD库，大多数开源程序也是用GD来处理图片的，但是它只能现实诸如调整大小、增加水印等基础功能，要想用GD来做复杂图形是非常困难的。 还好有个基于命令行的图像处理软件ImageMagick，能实现非常丰富的功能。如果服务器上安装了ImageMagick，php脚本可以使用shell命令来完成，也可以用php的原生函数库Imagick或者MagickWandForPHP函数来调用ImageMagick软件来实现。 因为Linux系统下PHP往往没有执行shell的权限，直接用shell来操作ImageMagick不太可能，综合考虑，Imagick函数库连接到ImageMagick软件比较好，而且是面向对象方式的。 Linux系统下，编译安装ImageMagick软件 wget ftp://ftp.imagemagick.org/pub/ImageMagick/ImageMagick-6.5.2-7.tar.gztar -zxvf ImageMagick-6.5.2-7.tar.gzcd ImageMagick-6.5.2-7/./configuremakemake install#译PHP原生库Imagickwget http://pecl.php.net/get/imagick-2.2.2.tgztar zxvf imagick-2.2.2.tgzcd imagick-2.2.2//usr/local/webserver/php/bin/phpize./configure --with-php-config=/usr/local/webserver/php/bin/php-configmakemake install#最后，修改php.ini，加上（去除下面#号）#extension = &quot;imagick.so&quot; 查看phpinfo，如果有Imagick，则说明安装成功。 详细安装可参考 Nginx 0.7.x + PHP5.2.9（FastCGI）搭建胜过Apache十倍的Web服务器（第5版）http://blog.s135.com/nginx_php_v5/ Imagick函数库资料太少，能参考的就是PHP官方手册http://cn2.php.net/imagick，但是无详细示例介绍。下面简单写了个实例，找了手册很长时间才做出来的，希望对大家有帮助。 原图http://test.studenthome.cn/imagick/b.jpg 按要求缩小图片尺寸、增加半透明边框，读入exif信息，按指定要求显示在图片上。 php生成的图片http://test.studenthome.cn/imagick/imagick4.php $towidth = &#39;500&#39;; $toheight = &#39;700&#39;; //设置图片调整大小时允许的最大宽度和高度 $sourcefile = &#39;./b.jpg&#39;; //定义一个图像文件路径 //$image-&gt;writeImage(&#39;./b.jpg.bak&#39;); //可以备份这个图片 $myimage = new Imagick( $sourcefile ); //读入该图像文件 $exifobject = my_exif( $myimage ); //自写函数，读取exif信息（拍摄数据），按自己的要求排列exif信息，返回对象 //$myimage-&gt;setImageFormat(&#39;jpeg&#39;); //把图片转为jpg格式 $myimage-&gt;setCompressionQuality( 100 ); //设置jpg压缩质量，1 - 100 $myimage-&gt;enhanceImage(); //去噪点 $sourcewidth = $myimage-&gt;getImageWidth(); //获取读入图像原始大小 if ( $sourcewidth &gt; $towidth ) { $myimage-&gt;scaleImage( $towidth, $toheight, true ); //调整图片大小 } $myimage-&gt;raiseImage( 8, 8, 0, 0, 1 ); //加半透明边框 $resizewidth = $myimage-&gt;getImageWidth(); //读出调整之后的图片大小 $resizeheight = $myimage-&gt;getImageHeight(); $drawback = new ImagickDraw(); //实例化一个绘画对象，绘制半透明黑色背景给exif信息用 $drawback-&gt;setFillColor( new ImagickPixel(&#39;#000000&#39;) ); //设置填充颜色为黑色 $drawback-&gt;setFillOpacity( 0.6 ); //填充透明度为0.6，参数0.1-1，1为不透明 $drawback-&gt;rectangle( $resizewidth / 2 - 190, $resizeheight - 50, $resizewidth / 2 + 190, $resizeheight - 12 ); //绘制矩形参数，分别为左上角x、y，右下角x、y $myimage-&gt;drawImage( $drawback ); //确认到image中绘制该矩形框 $draw = new ImagickDraw(); //实例化一个绘画对象，绘制exif文本信息嵌入图片中 $draw-&gt;setFont( &#39;./xianhei.ttf&#39; ); //设置文本字体，要求ttf或者ttc字体，可以绝对或者相对路径 $draw-&gt;setFontSize( 11 ); //设置字号 $draw-&gt;setTextAlignment( 2 ); //文字对齐方式，2为居中 $draw-&gt;setFillColor( &#39;#FFFFFF&#39; ); //文字填充颜色 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 39, 0, $exifobject-&gt;row1 ); //绘制第一行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 27, 0, $exifobject-&gt;row2 ); //绘制第二行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 15, 0, $exifobject-&gt;row3 ); //绘制第三行文本，居中 header( &#39;Content-type: image/jpeg&#39; ); //php文件输出mime类型为jpeg图片 echo $myimage; //在当前php页面输出图片 //$image-&gt;writeImage(&#39;./b.new.jpg&#39;); //如果图片不需要在当前php程序中输出，使用写入图片到磁盘函数，上面的设置header也可以去除 $myimage-&gt;clear(); $myimage-&gt;destroy(); //释放资源 //自写函数，读取exif信息，返回对象 function my_exif( $myimage ) { $exifArray = array( &#39;exif:Model&#39; =&gt; &#39;未知&#39;, &#39;exif:DateTimeOriginal&#39; =&gt; &#39;未知&#39;, &#39;exif:ExposureProgram&#39; =&gt; &#39;未知&#39;, &#39;exif:FNumber&#39; =&gt; &#39;0/10&#39;, &#39;exif:ExposureTime&#39; =&gt; &#39;0/10&#39;, &#39;exif:ISOSpeedRatings&#39; =&gt; &#39;未知&#39;, &#39;exif:MeteringMode&#39; =&gt; &#39;未知&#39;, &#39;exif:Flash&#39; =&gt; &#39;关闭闪光灯&#39;, &#39;exif:FocalLength&#39; =&gt; &#39;未知&#39;, &#39;exif:ExifImageWidth&#39; =&gt; &#39;未知&#39;, &#39;exif:ExifImageLength&#39; =&gt; &#39;未知&#39; ); //初始化部分信息，防止无法读取照片exif信息时运算发生错误 $exifArray = $myimage-&gt;getImageProperties( &quot;exif:*&quot; ); //读取图片的exif信息，存入$exifArray数组 //如果需要显示原数组可以使用print_r($exifArray); $r-&gt;row1 = &#39;相机:&#39; . $exifArray[&#39;exif:Model&#39;]; $r-&gt;row1 = $r-&gt;row1 . &#39; 拍摄时间:&#39; . $exifArray[&#39;exif:DateTimeOriginal&#39;]; switch ( $exifArray[&#39;exif:ExposureProgram&#39;] ) { case 1: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;手动(M)&quot;; break; //Manual Control case 2: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;程序自动(P)&quot;; break; //Program Normal case 3: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;光圈优先(A,Av)&quot;; break; //Aperture Priority case 4: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;快门优先(S,Tv)&quot;; break; //Shutter Priority case 5: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;慢速快门&quot;; break; //Program Creative (Slow Program) case 6: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;运动模式&quot;; break; //Program Action(High-Speed Program) case 7: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;人像&quot;; break; //Portrait case 8: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;风景&quot;; break; //Landscape default: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;其它&quot;; } $r-&gt;row1 = $r-&gt;row1 . &#39; 模式:&#39; . $exifArray[&#39;exif:ExposureProgram&#39;]; $exifArray[&#39;exif:FNumber&#39;] = explode( &#39;/&#39;, $exifArray[&#39;exif:FNumber&#39;] ); $exifArray[&#39;exif:FNumber&#39;] = $exifArray[&#39;exif:FNumber&#39;][0] / $exifArray[&#39;exif:FNumber&#39;][1]; $r-&gt;row2 = &#39;光圈:F/&#39; . $exifArray[&#39;exif:FNumber&#39;]; $exifArray[&#39;exif:ExposureTime&#39;] = explode( &#39;/&#39;, $exifArray[&#39;exif:ExposureTime&#39;] ); if ( ($exifArray[&#39;exif:ExposureTime&#39;][0] / $exifArray[&#39;exif:ExposureTime&#39;][1]) &gt;= 1 ) { $exifArray[&#39;exif:ExposureTime&#39;] = sprintf( &quot;%.1fs&quot;, (float)$exifArray[&#39;exif:ExposureTime&#39;][0] / $exifArray[&#39;exif:ExposureTime&#39;][1] ); } else { $exifArray[&#39;exif:ExposureTime&#39;] = sprintf( &quot;1/%ds&quot;, $exifArray[&#39;exif:ExposureTime&#39;][1] / $exifArray[&#39;exif:ExposureTime&#39;][0] ); } $r-&gt;row2 = $r-&gt;row2 . &#39; 快门:&#39; . $exifArray[&#39;exif:ExposureTime&#39;]; $r-&gt;row2 = $r-&gt;row2 . &#39; ISO:&#39; . $exifArray[&#39;exif:ISOSpeedRatings&#39;]; $exifArray[&#39;exif:Ex posureBiasValue&#39;] = explode( &quot;/&quot;, $exifArray[&#39;exif:ExposureBiasValue&#39;] ); $exifArray[&#39;exif:ExposureBiasValue&#39;] = sprintf( &quot;%1.1feV&quot;, ((float)$exifArray[&#39;exif:ExposureBiasValue&#39;][0] / $exifArray[&#39;exif:ExposureBiasValue&#39;][1] * 100) / 100 ); if ( (float)$exifArray[&#39;exif:ExposureBiasValue&#39;] &gt; 0 ) { $exifArray[&#39;exif:ExposureBiasValue&#39;] = &quot;+&quot; . $exifArray[&#39;exif:ExposureBiasValue&#39;]; } $r-&gt;row2 = $r-&gt;row2 . &#39; 补偿:&#39; . $exifArray[&#39;exif:ExposureBiasValue&#39;]; switch ( $exifArray[&#39;exif:MeteringMode&#39;] ) { case 0: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;未知&quot;; break; case 1: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;矩阵&quot;; break; case 2: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;中央重点平均&quot;; break; case 3: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;点测光&quot;; break; case 4: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;多点测光&quot;; break; default: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;其它&quot;; } $r-&gt;row2 = $r-&gt;row2 . &#39; 测光:&#39; . $exifArray[&#39;exif:MeteringMode&#39;]; switch ( $exifArray[&#39;exif:Flash&#39;] ) { case 1: $exifArray[&#39;exif:Flash&#39;] = &quot;开启闪光灯&quot;; break; } $r-&gt;row2 = $r-&gt;row2 . &#39; &#39; . $exifArray[&#39;exif:Flash&#39;]; if ( $exifArray[&#39;exif:FocalLengthIn35mmFilm&#39;] ) { $r-&gt;row3 = &#39;等效焦距:&#39; . $exifArray[&#39;exif:FocalLengthIn35mmFilm&#39;] . &quot;mm&quot;; } else { $exifArray[&#39;exif:FocalLength&#39;] = explode( &quot;/&quot;, $exifArray[&#39;exif:FocalLength&#39;] ); $exifArray[&#39;exif:FocalLength&#39;] = sprintf( &quot;%4.1fmm&quot;, (double)$exifArray[&#39;exif:FocalLength&#39;][0] / $exifArray[&#39;exif:FocalLength&#39;][1] ); $r-&gt;row3 = &#39;焦距:&#39; . $exifArray[&#39;exif:FocalLength&#39;]; } $r-&gt;row3 = $r-&gt;row3 . &#39; 原始像素:&#39; . $exifArray[&#39;exif:ExifImageWidth&#39;] . &#39;x&#39; . $exifArray[&#39;exif:ExifImageLength&#39;] . &#39;px&#39;; if ( $exifArray[&#39;exif:Software&#39;] ) { $r-&gt;row3 = $r-&gt;row3 . &#39; 后期:&#39; . $exifArray[&#39;exif:Software&#39;]; } return $r; }参考和原文http://dsec.pku.edu.cn/~yuhj/wiki/ImageMagick.htmlhttp://chenling1018.blog.163.com/blog/static/14802542010518102159792/" />
<meta property="og:description" content="一般用php处理图片都是使用GD库或者GD2的函数库，一般编译php环境都会搭上GD库，大多数开源程序也是用GD来处理图片的，但是它只能现实诸如调整大小、增加水印等基础功能，要想用GD来做复杂图形是非常困难的。 还好有个基于命令行的图像处理软件ImageMagick，能实现非常丰富的功能。如果服务器上安装了ImageMagick，php脚本可以使用shell命令来完成，也可以用php的原生函数库Imagick或者MagickWandForPHP函数来调用ImageMagick软件来实现。 因为Linux系统下PHP往往没有执行shell的权限，直接用shell来操作ImageMagick不太可能，综合考虑，Imagick函数库连接到ImageMagick软件比较好，而且是面向对象方式的。 Linux系统下，编译安装ImageMagick软件 wget ftp://ftp.imagemagick.org/pub/ImageMagick/ImageMagick-6.5.2-7.tar.gztar -zxvf ImageMagick-6.5.2-7.tar.gzcd ImageMagick-6.5.2-7/./configuremakemake install#译PHP原生库Imagickwget http://pecl.php.net/get/imagick-2.2.2.tgztar zxvf imagick-2.2.2.tgzcd imagick-2.2.2//usr/local/webserver/php/bin/phpize./configure --with-php-config=/usr/local/webserver/php/bin/php-configmakemake install#最后，修改php.ini，加上（去除下面#号）#extension = &quot;imagick.so&quot; 查看phpinfo，如果有Imagick，则说明安装成功。 详细安装可参考 Nginx 0.7.x + PHP5.2.9（FastCGI）搭建胜过Apache十倍的Web服务器（第5版）http://blog.s135.com/nginx_php_v5/ Imagick函数库资料太少，能参考的就是PHP官方手册http://cn2.php.net/imagick，但是无详细示例介绍。下面简单写了个实例，找了手册很长时间才做出来的，希望对大家有帮助。 原图http://test.studenthome.cn/imagick/b.jpg 按要求缩小图片尺寸、增加半透明边框，读入exif信息，按指定要求显示在图片上。 php生成的图片http://test.studenthome.cn/imagick/imagick4.php $towidth = &#39;500&#39;; $toheight = &#39;700&#39;; //设置图片调整大小时允许的最大宽度和高度 $sourcefile = &#39;./b.jpg&#39;; //定义一个图像文件路径 //$image-&gt;writeImage(&#39;./b.jpg.bak&#39;); //可以备份这个图片 $myimage = new Imagick( $sourcefile ); //读入该图像文件 $exifobject = my_exif( $myimage ); //自写函数，读取exif信息（拍摄数据），按自己的要求排列exif信息，返回对象 //$myimage-&gt;setImageFormat(&#39;jpeg&#39;); //把图片转为jpg格式 $myimage-&gt;setCompressionQuality( 100 ); //设置jpg压缩质量，1 - 100 $myimage-&gt;enhanceImage(); //去噪点 $sourcewidth = $myimage-&gt;getImageWidth(); //获取读入图像原始大小 if ( $sourcewidth &gt; $towidth ) { $myimage-&gt;scaleImage( $towidth, $toheight, true ); //调整图片大小 } $myimage-&gt;raiseImage( 8, 8, 0, 0, 1 ); //加半透明边框 $resizewidth = $myimage-&gt;getImageWidth(); //读出调整之后的图片大小 $resizeheight = $myimage-&gt;getImageHeight(); $drawback = new ImagickDraw(); //实例化一个绘画对象，绘制半透明黑色背景给exif信息用 $drawback-&gt;setFillColor( new ImagickPixel(&#39;#000000&#39;) ); //设置填充颜色为黑色 $drawback-&gt;setFillOpacity( 0.6 ); //填充透明度为0.6，参数0.1-1，1为不透明 $drawback-&gt;rectangle( $resizewidth / 2 - 190, $resizeheight - 50, $resizewidth / 2 + 190, $resizeheight - 12 ); //绘制矩形参数，分别为左上角x、y，右下角x、y $myimage-&gt;drawImage( $drawback ); //确认到image中绘制该矩形框 $draw = new ImagickDraw(); //实例化一个绘画对象，绘制exif文本信息嵌入图片中 $draw-&gt;setFont( &#39;./xianhei.ttf&#39; ); //设置文本字体，要求ttf或者ttc字体，可以绝对或者相对路径 $draw-&gt;setFontSize( 11 ); //设置字号 $draw-&gt;setTextAlignment( 2 ); //文字对齐方式，2为居中 $draw-&gt;setFillColor( &#39;#FFFFFF&#39; ); //文字填充颜色 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 39, 0, $exifobject-&gt;row1 ); //绘制第一行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 27, 0, $exifobject-&gt;row2 ); //绘制第二行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 15, 0, $exifobject-&gt;row3 ); //绘制第三行文本，居中 header( &#39;Content-type: image/jpeg&#39; ); //php文件输出mime类型为jpeg图片 echo $myimage; //在当前php页面输出图片 //$image-&gt;writeImage(&#39;./b.new.jpg&#39;); //如果图片不需要在当前php程序中输出，使用写入图片到磁盘函数，上面的设置header也可以去除 $myimage-&gt;clear(); $myimage-&gt;destroy(); //释放资源 //自写函数，读取exif信息，返回对象 function my_exif( $myimage ) { $exifArray = array( &#39;exif:Model&#39; =&gt; &#39;未知&#39;, &#39;exif:DateTimeOriginal&#39; =&gt; &#39;未知&#39;, &#39;exif:ExposureProgram&#39; =&gt; &#39;未知&#39;, &#39;exif:FNumber&#39; =&gt; &#39;0/10&#39;, &#39;exif:ExposureTime&#39; =&gt; &#39;0/10&#39;, &#39;exif:ISOSpeedRatings&#39; =&gt; &#39;未知&#39;, &#39;exif:MeteringMode&#39; =&gt; &#39;未知&#39;, &#39;exif:Flash&#39; =&gt; &#39;关闭闪光灯&#39;, &#39;exif:FocalLength&#39; =&gt; &#39;未知&#39;, &#39;exif:ExifImageWidth&#39; =&gt; &#39;未知&#39;, &#39;exif:ExifImageLength&#39; =&gt; &#39;未知&#39; ); //初始化部分信息，防止无法读取照片exif信息时运算发生错误 $exifArray = $myimage-&gt;getImageProperties( &quot;exif:*&quot; ); //读取图片的exif信息，存入$exifArray数组 //如果需要显示原数组可以使用print_r($exifArray); $r-&gt;row1 = &#39;相机:&#39; . $exifArray[&#39;exif:Model&#39;]; $r-&gt;row1 = $r-&gt;row1 . &#39; 拍摄时间:&#39; . $exifArray[&#39;exif:DateTimeOriginal&#39;]; switch ( $exifArray[&#39;exif:ExposureProgram&#39;] ) { case 1: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;手动(M)&quot;; break; //Manual Control case 2: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;程序自动(P)&quot;; break; //Program Normal case 3: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;光圈优先(A,Av)&quot;; break; //Aperture Priority case 4: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;快门优先(S,Tv)&quot;; break; //Shutter Priority case 5: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;慢速快门&quot;; break; //Program Creative (Slow Program) case 6: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;运动模式&quot;; break; //Program Action(High-Speed Program) case 7: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;人像&quot;; break; //Portrait case 8: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;风景&quot;; break; //Landscape default: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;其它&quot;; } $r-&gt;row1 = $r-&gt;row1 . &#39; 模式:&#39; . $exifArray[&#39;exif:ExposureProgram&#39;]; $exifArray[&#39;exif:FNumber&#39;] = explode( &#39;/&#39;, $exifArray[&#39;exif:FNumber&#39;] ); $exifArray[&#39;exif:FNumber&#39;] = $exifArray[&#39;exif:FNumber&#39;][0] / $exifArray[&#39;exif:FNumber&#39;][1]; $r-&gt;row2 = &#39;光圈:F/&#39; . $exifArray[&#39;exif:FNumber&#39;]; $exifArray[&#39;exif:ExposureTime&#39;] = explode( &#39;/&#39;, $exifArray[&#39;exif:ExposureTime&#39;] ); if ( ($exifArray[&#39;exif:ExposureTime&#39;][0] / $exifArray[&#39;exif:ExposureTime&#39;][1]) &gt;= 1 ) { $exifArray[&#39;exif:ExposureTime&#39;] = sprintf( &quot;%.1fs&quot;, (float)$exifArray[&#39;exif:ExposureTime&#39;][0] / $exifArray[&#39;exif:ExposureTime&#39;][1] ); } else { $exifArray[&#39;exif:ExposureTime&#39;] = sprintf( &quot;1/%ds&quot;, $exifArray[&#39;exif:ExposureTime&#39;][1] / $exifArray[&#39;exif:ExposureTime&#39;][0] ); } $r-&gt;row2 = $r-&gt;row2 . &#39; 快门:&#39; . $exifArray[&#39;exif:ExposureTime&#39;]; $r-&gt;row2 = $r-&gt;row2 . &#39; ISO:&#39; . $exifArray[&#39;exif:ISOSpeedRatings&#39;]; $exifArray[&#39;exif:Ex posureBiasValue&#39;] = explode( &quot;/&quot;, $exifArray[&#39;exif:ExposureBiasValue&#39;] ); $exifArray[&#39;exif:ExposureBiasValue&#39;] = sprintf( &quot;%1.1feV&quot;, ((float)$exifArray[&#39;exif:ExposureBiasValue&#39;][0] / $exifArray[&#39;exif:ExposureBiasValue&#39;][1] * 100) / 100 ); if ( (float)$exifArray[&#39;exif:ExposureBiasValue&#39;] &gt; 0 ) { $exifArray[&#39;exif:ExposureBiasValue&#39;] = &quot;+&quot; . $exifArray[&#39;exif:ExposureBiasValue&#39;]; } $r-&gt;row2 = $r-&gt;row2 . &#39; 补偿:&#39; . $exifArray[&#39;exif:ExposureBiasValue&#39;]; switch ( $exifArray[&#39;exif:MeteringMode&#39;] ) { case 0: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;未知&quot;; break; case 1: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;矩阵&quot;; break; case 2: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;中央重点平均&quot;; break; case 3: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;点测光&quot;; break; case 4: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;多点测光&quot;; break; default: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;其它&quot;; } $r-&gt;row2 = $r-&gt;row2 . &#39; 测光:&#39; . $exifArray[&#39;exif:MeteringMode&#39;]; switch ( $exifArray[&#39;exif:Flash&#39;] ) { case 1: $exifArray[&#39;exif:Flash&#39;] = &quot;开启闪光灯&quot;; break; } $r-&gt;row2 = $r-&gt;row2 . &#39; &#39; . $exifArray[&#39;exif:Flash&#39;]; if ( $exifArray[&#39;exif:FocalLengthIn35mmFilm&#39;] ) { $r-&gt;row3 = &#39;等效焦距:&#39; . $exifArray[&#39;exif:FocalLengthIn35mmFilm&#39;] . &quot;mm&quot;; } else { $exifArray[&#39;exif:FocalLength&#39;] = explode( &quot;/&quot;, $exifArray[&#39;exif:FocalLength&#39;] ); $exifArray[&#39;exif:FocalLength&#39;] = sprintf( &quot;%4.1fmm&quot;, (double)$exifArray[&#39;exif:FocalLength&#39;][0] / $exifArray[&#39;exif:FocalLength&#39;][1] ); $r-&gt;row3 = &#39;焦距:&#39; . $exifArray[&#39;exif:FocalLength&#39;]; } $r-&gt;row3 = $r-&gt;row3 . &#39; 原始像素:&#39; . $exifArray[&#39;exif:ExifImageWidth&#39;] . &#39;x&#39; . $exifArray[&#39;exif:ExifImageLength&#39;] . &#39;px&#39;; if ( $exifArray[&#39;exif:Software&#39;] ) { $r-&gt;row3 = $r-&gt;row3 . &#39; 后期:&#39; . $exifArray[&#39;exif:Software&#39;]; } return $r; }参考和原文http://dsec.pku.edu.cn/~yuhj/wiki/ImageMagick.htmlhttp://chenling1018.blog.163.com/blog/static/14802542010518102159792/" />
<link rel="canonical" href="http://www.fireidea.com/archives/128" />
<meta property="og:url" content="http://www.fireidea.com/archives/128" />
<meta property="og:site_name" content="徐艺洲" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-05-18T10:45:30+08:00" />
<script type="application/ld+json">
{"description":"一般用php处理图片都是使用GD库或者GD2的函数库，一般编译php环境都会搭上GD库，大多数开源程序也是用GD来处理图片的，但是它只能现实诸如调整大小、增加水印等基础功能，要想用GD来做复杂图形是非常困难的。 还好有个基于命令行的图像处理软件ImageMagick，能实现非常丰富的功能。如果服务器上安装了ImageMagick，php脚本可以使用shell命令来完成，也可以用php的原生函数库Imagick或者MagickWandForPHP函数来调用ImageMagick软件来实现。 因为Linux系统下PHP往往没有执行shell的权限，直接用shell来操作ImageMagick不太可能，综合考虑，Imagick函数库连接到ImageMagick软件比较好，而且是面向对象方式的。 Linux系统下，编译安装ImageMagick软件 wget ftp://ftp.imagemagick.org/pub/ImageMagick/ImageMagick-6.5.2-7.tar.gztar -zxvf ImageMagick-6.5.2-7.tar.gzcd ImageMagick-6.5.2-7/./configuremakemake install#译PHP原生库Imagickwget http://pecl.php.net/get/imagick-2.2.2.tgztar zxvf imagick-2.2.2.tgzcd imagick-2.2.2//usr/local/webserver/php/bin/phpize./configure --with-php-config=/usr/local/webserver/php/bin/php-configmakemake install#最后，修改php.ini，加上（去除下面#号）#extension = &quot;imagick.so&quot; 查看phpinfo，如果有Imagick，则说明安装成功。 详细安装可参考 Nginx 0.7.x + PHP5.2.9（FastCGI）搭建胜过Apache十倍的Web服务器（第5版）http://blog.s135.com/nginx_php_v5/ Imagick函数库资料太少，能参考的就是PHP官方手册http://cn2.php.net/imagick，但是无详细示例介绍。下面简单写了个实例，找了手册很长时间才做出来的，希望对大家有帮助。 原图http://test.studenthome.cn/imagick/b.jpg 按要求缩小图片尺寸、增加半透明边框，读入exif信息，按指定要求显示在图片上。 php生成的图片http://test.studenthome.cn/imagick/imagick4.php $towidth = &#39;500&#39;; $toheight = &#39;700&#39;; //设置图片调整大小时允许的最大宽度和高度 $sourcefile = &#39;./b.jpg&#39;; //定义一个图像文件路径 //$image-&gt;writeImage(&#39;./b.jpg.bak&#39;); //可以备份这个图片 $myimage = new Imagick( $sourcefile ); //读入该图像文件 $exifobject = my_exif( $myimage ); //自写函数，读取exif信息（拍摄数据），按自己的要求排列exif信息，返回对象 //$myimage-&gt;setImageFormat(&#39;jpeg&#39;); //把图片转为jpg格式 $myimage-&gt;setCompressionQuality( 100 ); //设置jpg压缩质量，1 - 100 $myimage-&gt;enhanceImage(); //去噪点 $sourcewidth = $myimage-&gt;getImageWidth(); //获取读入图像原始大小 if ( $sourcewidth &gt; $towidth ) { $myimage-&gt;scaleImage( $towidth, $toheight, true ); //调整图片大小 } $myimage-&gt;raiseImage( 8, 8, 0, 0, 1 ); //加半透明边框 $resizewidth = $myimage-&gt;getImageWidth(); //读出调整之后的图片大小 $resizeheight = $myimage-&gt;getImageHeight(); $drawback = new ImagickDraw(); //实例化一个绘画对象，绘制半透明黑色背景给exif信息用 $drawback-&gt;setFillColor( new ImagickPixel(&#39;#000000&#39;) ); //设置填充颜色为黑色 $drawback-&gt;setFillOpacity( 0.6 ); //填充透明度为0.6，参数0.1-1，1为不透明 $drawback-&gt;rectangle( $resizewidth / 2 - 190, $resizeheight - 50, $resizewidth / 2 + 190, $resizeheight - 12 ); //绘制矩形参数，分别为左上角x、y，右下角x、y $myimage-&gt;drawImage( $drawback ); //确认到image中绘制该矩形框 $draw = new ImagickDraw(); //实例化一个绘画对象，绘制exif文本信息嵌入图片中 $draw-&gt;setFont( &#39;./xianhei.ttf&#39; ); //设置文本字体，要求ttf或者ttc字体，可以绝对或者相对路径 $draw-&gt;setFontSize( 11 ); //设置字号 $draw-&gt;setTextAlignment( 2 ); //文字对齐方式，2为居中 $draw-&gt;setFillColor( &#39;#FFFFFF&#39; ); //文字填充颜色 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 39, 0, $exifobject-&gt;row1 ); //绘制第一行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 27, 0, $exifobject-&gt;row2 ); //绘制第二行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 15, 0, $exifobject-&gt;row3 ); //绘制第三行文本，居中 header( &#39;Content-type: image/jpeg&#39; ); //php文件输出mime类型为jpeg图片 echo $myimage; //在当前php页面输出图片 //$image-&gt;writeImage(&#39;./b.new.jpg&#39;); //如果图片不需要在当前php程序中输出，使用写入图片到磁盘函数，上面的设置header也可以去除 $myimage-&gt;clear(); $myimage-&gt;destroy(); //释放资源 //自写函数，读取exif信息，返回对象 function my_exif( $myimage ) { $exifArray = array( &#39;exif:Model&#39; =&gt; &#39;未知&#39;, &#39;exif:DateTimeOriginal&#39; =&gt; &#39;未知&#39;, &#39;exif:ExposureProgram&#39; =&gt; &#39;未知&#39;, &#39;exif:FNumber&#39; =&gt; &#39;0/10&#39;, &#39;exif:ExposureTime&#39; =&gt; &#39;0/10&#39;, &#39;exif:ISOSpeedRatings&#39; =&gt; &#39;未知&#39;, &#39;exif:MeteringMode&#39; =&gt; &#39;未知&#39;, &#39;exif:Flash&#39; =&gt; &#39;关闭闪光灯&#39;, &#39;exif:FocalLength&#39; =&gt; &#39;未知&#39;, &#39;exif:ExifImageWidth&#39; =&gt; &#39;未知&#39;, &#39;exif:ExifImageLength&#39; =&gt; &#39;未知&#39; ); //初始化部分信息，防止无法读取照片exif信息时运算发生错误 $exifArray = $myimage-&gt;getImageProperties( &quot;exif:*&quot; ); //读取图片的exif信息，存入$exifArray数组 //如果需要显示原数组可以使用print_r($exifArray); $r-&gt;row1 = &#39;相机:&#39; . $exifArray[&#39;exif:Model&#39;]; $r-&gt;row1 = $r-&gt;row1 . &#39; 拍摄时间:&#39; . $exifArray[&#39;exif:DateTimeOriginal&#39;]; switch ( $exifArray[&#39;exif:ExposureProgram&#39;] ) { case 1: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;手动(M)&quot;; break; //Manual Control case 2: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;程序自动(P)&quot;; break; //Program Normal case 3: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;光圈优先(A,Av)&quot;; break; //Aperture Priority case 4: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;快门优先(S,Tv)&quot;; break; //Shutter Priority case 5: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;慢速快门&quot;; break; //Program Creative (Slow Program) case 6: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;运动模式&quot;; break; //Program Action(High-Speed Program) case 7: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;人像&quot;; break; //Portrait case 8: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;风景&quot;; break; //Landscape default: $exifArray[&#39;exif:ExposureProgram&#39;] = &quot;其它&quot;; } $r-&gt;row1 = $r-&gt;row1 . &#39; 模式:&#39; . $exifArray[&#39;exif:ExposureProgram&#39;]; $exifArray[&#39;exif:FNumber&#39;] = explode( &#39;/&#39;, $exifArray[&#39;exif:FNumber&#39;] ); $exifArray[&#39;exif:FNumber&#39;] = $exifArray[&#39;exif:FNumber&#39;][0] / $exifArray[&#39;exif:FNumber&#39;][1]; $r-&gt;row2 = &#39;光圈:F/&#39; . $exifArray[&#39;exif:FNumber&#39;]; $exifArray[&#39;exif:ExposureTime&#39;] = explode( &#39;/&#39;, $exifArray[&#39;exif:ExposureTime&#39;] ); if ( ($exifArray[&#39;exif:ExposureTime&#39;][0] / $exifArray[&#39;exif:ExposureTime&#39;][1]) &gt;= 1 ) { $exifArray[&#39;exif:ExposureTime&#39;] = sprintf( &quot;%.1fs&quot;, (float)$exifArray[&#39;exif:ExposureTime&#39;][0] / $exifArray[&#39;exif:ExposureTime&#39;][1] ); } else { $exifArray[&#39;exif:ExposureTime&#39;] = sprintf( &quot;1/%ds&quot;, $exifArray[&#39;exif:ExposureTime&#39;][1] / $exifArray[&#39;exif:ExposureTime&#39;][0] ); } $r-&gt;row2 = $r-&gt;row2 . &#39; 快门:&#39; . $exifArray[&#39;exif:ExposureTime&#39;]; $r-&gt;row2 = $r-&gt;row2 . &#39; ISO:&#39; . $exifArray[&#39;exif:ISOSpeedRatings&#39;]; $exifArray[&#39;exif:Ex posureBiasValue&#39;] = explode( &quot;/&quot;, $exifArray[&#39;exif:ExposureBiasValue&#39;] ); $exifArray[&#39;exif:ExposureBiasValue&#39;] = sprintf( &quot;%1.1feV&quot;, ((float)$exifArray[&#39;exif:ExposureBiasValue&#39;][0] / $exifArray[&#39;exif:ExposureBiasValue&#39;][1] * 100) / 100 ); if ( (float)$exifArray[&#39;exif:ExposureBiasValue&#39;] &gt; 0 ) { $exifArray[&#39;exif:ExposureBiasValue&#39;] = &quot;+&quot; . $exifArray[&#39;exif:ExposureBiasValue&#39;]; } $r-&gt;row2 = $r-&gt;row2 . &#39; 补偿:&#39; . $exifArray[&#39;exif:ExposureBiasValue&#39;]; switch ( $exifArray[&#39;exif:MeteringMode&#39;] ) { case 0: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;未知&quot;; break; case 1: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;矩阵&quot;; break; case 2: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;中央重点平均&quot;; break; case 3: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;点测光&quot;; break; case 4: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;多点测光&quot;; break; default: $exifArray[&#39;exif:MeteringMode&#39;] = &quot;其它&quot;; } $r-&gt;row2 = $r-&gt;row2 . &#39; 测光:&#39; . $exifArray[&#39;exif:MeteringMode&#39;]; switch ( $exifArray[&#39;exif:Flash&#39;] ) { case 1: $exifArray[&#39;exif:Flash&#39;] = &quot;开启闪光灯&quot;; break; } $r-&gt;row2 = $r-&gt;row2 . &#39; &#39; . $exifArray[&#39;exif:Flash&#39;]; if ( $exifArray[&#39;exif:FocalLengthIn35mmFilm&#39;] ) { $r-&gt;row3 = &#39;等效焦距:&#39; . $exifArray[&#39;exif:FocalLengthIn35mmFilm&#39;] . &quot;mm&quot;; } else { $exifArray[&#39;exif:FocalLength&#39;] = explode( &quot;/&quot;, $exifArray[&#39;exif:FocalLength&#39;] ); $exifArray[&#39;exif:FocalLength&#39;] = sprintf( &quot;%4.1fmm&quot;, (double)$exifArray[&#39;exif:FocalLength&#39;][0] / $exifArray[&#39;exif:FocalLength&#39;][1] ); $r-&gt;row3 = &#39;焦距:&#39; . $exifArray[&#39;exif:FocalLength&#39;]; } $r-&gt;row3 = $r-&gt;row3 . &#39; 原始像素:&#39; . $exifArray[&#39;exif:ExifImageWidth&#39;] . &#39;x&#39; . $exifArray[&#39;exif:ExifImageLength&#39;] . &#39;px&#39;; if ( $exifArray[&#39;exif:Software&#39;] ) { $r-&gt;row3 = $r-&gt;row3 . &#39; 后期:&#39; . $exifArray[&#39;exif:Software&#39;]; } return $r; }参考和原文http://dsec.pku.edu.cn/~yuhj/wiki/ImageMagick.htmlhttp://chenling1018.blog.163.com/blog/static/14802542010518102159792/","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.fireidea.com/archives/128"},"@type":"BlogPosting","url":"http://www.fireidea.com/archives/128","headline":"转：用Imagick替代php的GD库-强大~","dateModified":"2011-05-18T10:45:30+08:00","datePublished":"2011-05-18T10:45:30+08:00","author":{"@type":"Person","name":"徐艺洲"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://www.fireidea.com/feed.xml" title="徐艺洲" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">徐艺洲</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/aboutme.html">关于我</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">转：用Imagick替代php的GD库-强大~</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2011-05-18T10:45:30+08:00" itemprop="datePublished">May 18, 2011
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">徐艺洲</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div id="sina_keyword_ad_area2" class="articalContent   ">
  <p style="TexT-inDenT: 2em;">
    一般用php处理图片都是使用GD库或者GD2的函数库，一般编译php环境都会搭上GD库，大多数开源程序也是用GD来处理图片的，但是它只能现实诸如调整大小、增加水印等基础功能，要想用GD来做复杂图形是非常困难的。
  </p>
  
  <p style="TexT-inDenT: 2em;">
    还好有个基于命令行的图像处理软件ImageMagick，能实现非常丰富的功能。如果服务器上安装了ImageMagick，php脚本可以使用shell命令来完成，也可以用php的原生函数库Imagick或者MagickWandForPHP函数来调用ImageMagick软件来实现。
  </p>
  
  <p style="TexT-inDenT: 2em;">
    因为Linux系统下PHP往往没有执行shell的权限，直接用shell来操作ImageMagick不太可能，综合考虑，Imagick函数库连接到ImageMagick软件比较好，而且是面向对象方式的。
  </p>
  
  <p style="TexT-inDenT: 2em;">
    Linux系统下，编译安装ImageMagick软件
  </p>
  
  <pre>wget ftp://ftp.imagemagick.org/pub/ImageMagick/ImageMagick-6.5.2-7.tar.gztar -zxvf ImageMagick-6.5.2-7.tar.gzcd ImageMagick-6.5.2-7/./configuremakemake install#译PHP原生库Imagickwget http://pecl.php.net/get/imagick-2.2.2.tgztar zxvf imagick-2.2.2.tgzcd imagick-2.2.2//usr/local/webserver/php/bin/phpize./configure --with-php-config=/usr/local/webserver/php/bin/php-configmakemake install#最后，修改php.ini，加上（去除下面#号）#extension = "imagick.so"</pre>
  
  <p style="TexT-inDenT: 2em;">
    查看phpinfo，如果有Imagick，则说明安装成功。
  </p>
  
  <p style="TexT-inDenT: 2em;">
    <img alt="用Imagick替代php的GD库 - 边城浪子 - 记录人生轨迹,寻找人生航向!" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://img01.littz.com/portal/2009/06/1_200906040253561ZxwK.thumb.jpg" border="0" title="转：用Imagick替代php的GD库-强大~" />
  </p>
  
  <p style="TexT-inDenT: 2em;">
    详细安装可参考 Nginx 0.7.x + PHP5.2.9（FastCGI）搭建胜过Apache十倍的Web服务器（第5版）http://blog.s135.com/nginx_php_v5/
  </p>
  
  <p style="TexT-inDenT: 2em;">
    Imagick函数库资料太少，能参考的就是PHP官方手册http://cn2.php.net/imagick，但是无详细示例介绍。下面简单写了个实例，找了手册很长时间才做出来的，希望对大家有帮助。
  </p>
  
  <p style="TexT-inDenT: 2em;">
    原图http://test.studenthome.cn/imagick/b.jpg
  </p>
  
  <p style="TexT-inDenT: 2em;">
    按要求缩小图片尺寸、增加半透明边框，读入exif信息，按指定要求显示在图片上。
  </p>
  
  <p style="TexT-inDenT: 2em;">
    php生成的图片http://test.studenthome.cn/imagick/imagick4.php
  </p>
  
  <pre> $towidth = '500'; $toheight = '700'; //设置图片调整大小时允许的最大宽度和高度 $sourcefile = './b.jpg'; //定义一个图像文件路径 //$image-&gt;writeImage('./b.jpg.bak'); //可以备份这个图片 $myimage = new Imagick( $sourcefile ); //读入该图像文件 $exifobject = my_exif( $myimage ); //自写函数，读取exif信息（拍摄数据），按自己的要求排列exif信息，返回对象 //$myimage-&gt;setImageFormat('jpeg'); //把图片转为jpg格式 $myimage-&gt;setCompressionQuality( 100 ); //设置jpg压缩质量，1 - 100 $myimage-&gt;enhanceImage(); //去噪点 $sourcewidth = $myimage-&gt;getImageWidth(); //获取读入图像原始大小 if ( $sourcewidth &gt; $towidth ) {   $myimage-&gt;scaleImage( $towidth, $toheight, true ); //调整图片大小 } $myimage-&gt;raiseImage( 8, 8, 0, 0, 1 ); //加半透明边框 $resizewidth = $myimage-&gt;getImageWidth(); //读出调整之后的图片大小 $resizeheight = $myimage-&gt;getImageHeight(); $drawback = new ImagickDraw(); //实例化一个绘画对象，绘制半透明黑色背景给exif信息用 $drawback-&gt;setFillColor( new ImagickPixel('#000000') ); //设置填充颜色为黑色 $drawback-&gt;setFillOpacity( 0.6 ); //填充透明度为0.6，参数0.1-1，1为不透明 $drawback-&gt;rectangle( $resizewidth / 2 - 190, $resizeheight - 50, $resizewidth / 2 + 190, $resizeheight - 12 ); //绘制矩形参数，分别为左上角x、y，右下角x、y $myimage-&gt;drawImage( $drawback ); //确认到image中绘制该矩形框 $draw = new ImagickDraw(); //实例化一个绘画对象，绘制exif文本信息嵌入图片中 $draw-&gt;setFont( './xianhei.ttf' ); //设置文本字体，要求ttf或者ttc字体，可以绝对或者相对路径 $draw-&gt;setFontSize( 11 ); //设置字号 $draw-&gt;setTextAlignment( 2 ); //文字对齐方式，2为居中 $draw-&gt;setFillColor( '#FFFFFF' ); //文字填充颜色 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 39, 0, $exifobject-&gt;row1 ); //绘制第一行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 27, 0, $exifobject-&gt;row2 ); //绘制第二行文本，居中 $myimage-&gt;annotateImage( $draw, $resizewidth / 2, $resizeheight - 15, 0, $exifobject-&gt;row3 ); //绘制第三行文本，居中  header( 'Content-type: image/jpeg' ); //php文件输出mime类型为jpeg图片 echo $myimage; //在当前php页面输出图片 //$image-&gt;writeImage('./b.new.jpg'); //如果图片不需要在当前php程序中输出，使用写入图片到磁盘函数，上面的设置header也可以去除 $myimage-&gt;clear(); $myimage-&gt;destroy(); //释放资源 //自写函数，读取exif信息，返回对象 function my_exif( $myimage ) {   $exifArray = array( 'exif:Model' =&gt; '未知', 'exif:DateTimeOriginal' =&gt; '未知', 'exif:ExposureProgram' =&gt; '未知', 'exif:FNumber' =&gt; '0/10', 'exif:ExposureTime' =&gt; '0/10', 'exif:ISOSpeedRatings' =&gt; '未知',     'exif:MeteringMode' =&gt; '未知', 'exif:Flash' =&gt; '关闭闪光灯', 'exif:FocalLength' =&gt; '未知', 'exif:ExifImageWidth' =&gt; '未知', 'exif:ExifImageLength' =&gt; '未知' ); //初始化部分信息，防止无法读取照片exif信息时运算发生错误   $exifArray = $myimage-&gt;getImageProperties( "exif:*" ); //读取图片的exif信息，存入$exifArray数组   //如果需要显示原数组可以使用print_r($exifArray);   $r-&gt;row1 = '相机:' . $exifArray['exif:Model'];   $r-&gt;row1 = $r-&gt;row1 . ' 拍摄时间:' . $exifArray['exif:DateTimeOriginal'];   switch ( $exifArray['exif:ExposureProgram'] )   {     case 1:       $exifArray['exif:ExposureProgram'] = "手动(M)";       break; //Manual Control     case 2:       $exifArray['exif:ExposureProgram'] = "程序自动(P)";       break; //Program Normal     case 3:       $exifArray['exif:ExposureProgram'] = "光圈优先(A,Av)";       break; //Aperture Priority     case 4:       $exifArray['exif:ExposureProgram'] = "快门优先(S,Tv)";       break; //Shutter Priority     case 5:       $exifArray['exif:ExposureProgram'] = "慢速快门";       break; //Program Creative (Slow Program)     case 6:       $exifArray['exif:ExposureProgram'] = "运动模式";       break; //Program Action(High-Speed Program)     case 7:       $exifArray['exif:ExposureProgram'] = "人像";       break; //Portrait     case 8:       $exifArray['exif:ExposureProgram'] = "风景";       break; //Landscape     default:       $exifArray['exif:ExposureProgram'] = "其它";   }   $r-&gt;row1 = $r-&gt;row1 . ' 模式:' . $exifArray['exif:ExposureProgram'];   $exifArray['exif:FNumber'] = explode( '/', $exifArray['exif:FNumber'] );   $exifArray['exif:FNumber'] = $exifArray['exif:FNumber'][0] / $exifArray['exif:FNumber'][1];   $r-&gt;row2 = '光圈:F/' . $exifArray['exif:FNumber'];   $exifArray['exif:ExposureTime'] = explode( '/', $exifArray['exif:ExposureTime'] );   if ( ($exifArray['exif:ExposureTime'][0] / $exifArray['exif:ExposureTime'][1]) &gt;= 1 )   {     $exifArray['exif:ExposureTime'] = sprintf( "%.1fs", (float)$exifArray['exif:ExposureTime'][0] / $exifArray['exif:ExposureTime'][1] );   } else   {     $exifArray['exif:ExposureTime'] = sprintf( "1/%ds", $exifArray['exif:ExposureTime'][1] / $exifArray['exif:ExposureTime'][0] );   }   $r-&gt;row2 = $r-&gt;row2 . ' 快门:' . $exifArray['exif:ExposureTime'];   $r-&gt;row2 = $r-&gt;row2 . ' ISO:' . $exifArray['exif:ISOSpeedRatings'];   $exifArray['exif:Ex
posureBiasValue'] = explode( "/", $exifArray['exif:ExposureBiasValue'] );   $exifArray['exif:ExposureBiasValue'] = sprintf( "%1.1feV", ((float)$exifArray['exif:ExposureBiasValue'][0] / $exifArray['exif:ExposureBiasValue'][1] * 100) / 100 );   if ( (float)$exifArray['exif:ExposureBiasValue'] &gt; 0 )   {     $exifArray['exif:ExposureBiasValue'] = "+" . $exifArray['exif:ExposureBiasValue'];   }   $r-&gt;row2 = $r-&gt;row2 . ' 补偿:' . $exifArray['exif:ExposureBiasValue'];   switch ( $exifArray['exif:MeteringMode'] )   {     case 0:       $exifArray['exif:MeteringMode'] = "未知";       break;     case 1:       $exifArray['exif:MeteringMode'] = "矩阵";       break;     case 2:       $exifArray['exif:MeteringMode'] = "中央重点平均";       break;     case 3:       $exifArray['exif:MeteringMode'] = "点测光";       break;     case 4:       $exifArray['exif:MeteringMode'] = "多点测光";       break;     default:       $exifArray['exif:MeteringMode'] = "其它";   }   $r-&gt;row2 = $r-&gt;row2 . ' 测光:' . $exifArray['exif:MeteringMode'];   switch ( $exifArray['exif:Flash'] )   {     case 1:       $exifArray['exif:Flash'] = "开启闪光灯";       break;   }   $r-&gt;row2 = $r-&gt;row2 . ' ' . $exifArray['exif:Flash'];   if ( $exifArray['exif:FocalLengthIn35mmFilm'] )   {     $r-&gt;row3 = '等效焦距:' . $exifArray['exif:FocalLengthIn35mmFilm'] . "mm";   } else   {     $exifArray['exif:FocalLength'] = explode( "/", $exifArray['exif:FocalLength'] );     $exifArray['exif:FocalLength'] = sprintf( "%4.1fmm", (double)$exifArray['exif:FocalLength'][0] / $exifArray['exif:FocalLength'][1] );     $r-&gt;row3 = '焦距:' . $exifArray['exif:FocalLength'];   }   $r-&gt;row3 = $r-&gt;row3 . ' 原始像素:' . $exifArray['exif:ExifImageWidth'] . 'x' . $exifArray['exif:ExifImageLength'] . 'px';   if ( $exifArray['exif:Software'] )   {     $r-&gt;row3 = $r-&gt;row3 . ' 后期:' . $exifArray['exif:Software'];   }   return $r; }<br /><br />参考和原文<br />http://dsec.pku.edu.cn/~yuhj/wiki/ImageMagick.html<br />http://chenling1018.blog.163.com/blog/static/14802542010518102159792/<br /></pre>
</div>

  </div><a class="u-url" href="/archives/128" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col one-half">
      <h2 class="footer-heading">徐艺洲</h2>
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col one-half">
        <p>知止定静安虑得</p>
      </div>

      <div class="social-links"><ul class="social-media-list"></ul>
</div>
    </div>

  </div>

</footer>
</body>

</html>
